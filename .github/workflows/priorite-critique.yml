- name: Assigner + mettre le statut √† To do
  uses: actions/github-script@v7
  with:
    script: |
      const owner = context.repo.owner;
      const repo = context.repo.repo;
      const issueNumber = context.issue.number;

      /* 1Ô∏è‚É£ Assigner automatiquement le Lead Dev */
      await github.rest.issues.addAssignees({
        owner,
        repo,
        issue_number: issueNumber,
        assignees: [owner],
      });

      /* 2Ô∏è‚É£ R√©cup√©rer l‚ÄôID GraphQL de l‚Äôissue */
      const issueData = await github.graphql(`
        query($owner: String!, $repo: String!, $number: Int!) {
          repository(owner: $owner, name: $repo) {
            issue(number: $number) {
              id
            }
          }
        }
      `, {
        owner,
        repo,
        number: issueNumber
      });

      const issueId = issueData.repository.issue.id;

      /* ‚ö†Ô∏è √Ä REMPLACER MANUELLEMENT */
      const projectId = "PROJECT_ID_ICI";
      const statusFieldId = "STATUS_FIELD_ID_ICI";
      const todoOptionId = "TODO_OPTION_ID_ICI";

      /* 3Ô∏è‚É£ Ajouter l‚Äôissue au Project */
      const addItem = await github.graphql(`
        mutation($projectId: ID!, $contentId: ID!) {
          addProjectV2ItemById(input: {
            projectId: $projectId
            contentId: $contentId
          }) {
            item {
              id
            }
          }
        }
      `, {
        projectId,
        contentId: issueId
      });

      const itemId = addItem.addProjectV2ItemById.item.id;

      /* 4Ô∏è‚É£ Mettre le statut √† "To do" */
      await github.graphql(`
        mutation {
          updateProjectV2ItemFieldValue(input: {
            projectId: "${projectId}"
            itemId: "${itemId}"
            fieldId: "${statusFieldId}"
            value: {
              singleSelectOptionId: "${todoOptionId}"
            }
          }) {
            projectV2Item {
              id
            }
          }
        }
      `);

      /* 5Ô∏è‚É£ Commentaire automatique */
      await github.rest.issues.createComment({
        owner,
        repo,
        issue_number: issueNumber,
        body: "üö® **Alerte Critique** : Issue assign√©e automatiquement et d√©plac√©e en **To do** dans le Project."
      });
